# 🌐 Node.js 기초 및 핵심 개념

## 1. Node.js 기초와 핵심 개념
- JavaScript는 원래 웹 브라우저 안에서만 실행되던 언어였다. Google이 브라우저의 JavaScript 엔진 V8을 공개하면서 달라졌다. V8 엔진을 브라우저 밖으로 가져와 서버나 데스크톱에서 실행할 수 있도록 만든 런타임이 바로 Node.js다.
 

### 1-1. 🎯 Node.js란 무엇인가?
**Node.js는 언어가 아니라 JavaScript를 실행하는 런타임 환경**이다. 
- Node.js 소개에 따르면 오픈 소스이면서 크로스 플랫폼인 JavaScript 런타임, 개발자가 서버, 웹 애플리케이션, 명령행 동구 등을 만들 수 있게 해준다.
- Node.js는 V8 JavaScript 엔진을 브라우저 밖으로 가져와 자바스크립트를 고성능으로 실행, 파일 시스템 접근, 네트워크 통신 등 브라우저에 제공하지 않는 기능을 제공한다.

### 1-2. 런타임 환경이냐 프로그래밍 언어이냐?

- JavaScript 자체는 문법과 규칙을 정의한 언어, 브라우저와 Node.js에서 언어를 실행하는 환경이다. 브라우저 환경에 DOM, `window` 객체, 쿠키 등 웹 플랫폼 API를 제공, Node.js에서 이러한 객체가 존재하지 않고 대신 파일 시스템과 네트워크, 프로세스 관리 등 OS 수준의 API를 제공한다. 
- **Node.js는 새로운 언어가 아니라 기존 JavaScript를 서버나 데스크톱에서 실행하도록 돕는 플랫폼**이다.

### 1-3. Node.js 핵심 특징

1. V8 엔진 기반: 
   - Node.js는 Chrome V8 엔진으로 JavaScript 코드를 JIT 컴파일해 빠르게 실행한다. V8 엔진은 브라우저에 종속되지 않기에 독립적인 런타임에서 사용할 수 있다.

2. 단일 프로세스, 이벤트 기반:
   - Node.js 프로그램은 기본적으로 하나의 프로세스에 실행되고, 새 요청마다 스레드를 만들지 않는다. 대신 **이벤트 루프**를 통해 비동기 I/O 작업을 처리한다. 

3. 비동기, 논블로킹 I/O:
   - Node.js는 시스템 커널에 작업을 offload하고, 완료되면 콜백을 실행함으로 논블로킹 I/O를 구현한다. 덕분에 수많은 동시 연결을 효율적으로 처리할 수 있다. 

4. libuv와 이벤트 루프:
   - Node.js 이벤트 루프는 C라이브러리인 libuv가 구현한다. libuv는 이벤트 루프와 비동기 I/O를 담당, poll phase가 지나치게 오래 걸리지 않도록 시스템 별 최대 제한을 둔다.

---

## 2. 서버와 런타임: Node.js는 어떻게 사용?

### 2-1. 🌅 서버란?
- 서버는 네트워크를 통해 클라에게 정보나 서비스를 제공하는 프로그램 또는 컴퓨터이다.
- 웹 브라우저, 데스크톱 앱, 다른 서버 등 클라이언트가 요청(request)을 보내면 서버는 응답(response)을 반환한다.
- 브라우저 주소창에 URL을 입력하면 브라우저는 해당 서버에 HTML, 이미지 등을 요청, 서버는 이를 응답으로 전송한다.
- 앱스토어에서 애플리케이션을 다운로드할때도 서버가 클라에게 설치 파일을 제공한다.

### 2-2 Node.js의 서버 역할
- Node.js는 기본적으로 싱글 스레드에 비동기 I/O 모델을 사용, 서버 프로그래밍에 적합하다.
- `http` 모듈을 포함 표준 라이브러리를 통해 HTTP 서버를 손쉽게 만들수 있고, 네트워크, 파일 시스템, 프로세스 제어 등 다양한 모듈을 제공한다.
- 이러한 특성 덕분에 Node.js는 실시간 채팅, 스트리밍, API 서버와 같이 I/O 요청이 많은 애플리케이션에 자주 사용된다.
```JS
const http = require('node:http');

const server = http.createSever((req, res) => {
   res.writeHead(200, { 'Content-Type': 'text/plain'});
   res.end('Hello from Node.js server!');
});

server.listen(3000, () => {
   console.log('Listening on http://localhost:3000');
});
```

### 2-3 Node.js 아키텍처
- Node.js는 여러 구성요소로 이루어져있다.
| 구성 요소 | 역할 |
| :--- | :--- |
| **JavaScript 코드** | 개발자가 작성하는 애플리케이션 로직 |
| **Node.js API** | `fs`, `http`, `path` 등 파일·네트워크 처리 기능 제공 |
| **바인딩(Bindings)** | C++로 작성된 Node.js 내부 모듈과 JavaScript 사이의 연결 역할 |
| **V8 엔진** | JavaScript를 JIT 컴파일해 실행하는 엔진 |
| **libuv** | 이벤트 루프와 스레드 풀을 구현하고 비동기 I/O를 담당 |
| **운영 체제** | 파일 시스템, 네트워크, 프로세스 관리 등 하드웨어 자원 제공 |

### 2-4 이벤트 루프와 비동기 I/O
- Node.js는 하나의 스레드에서 실행, **이벤트 루프(Event Loop)**를 통해 수천개의 동시 I/O 작업을 처리한다.
- 이벤트 루프는 여러 단계(타이머, poll, check 등)로 구성되고, 각 단계에서 큐에 쌓인 콜백을 FIFO 방식으로 실행한다.
- 비동기 작업(파일 읽기, 네트워크 요청 등)은 운영체제 커널에 위임, 완료되면 큐에 콜백을 등록하여 다음 루프에서 실행된다.
- 이러한 구조 덕분에 CPU 사용량이 적은 I/O 집약적 애플리케이션을 효율적으로 처리할 수 있다.

### 2-5 워커 스레드와 CPU 집중 작업
- Node.js는 기본적으로 단일 스레드로 동작, **CPU 집약적인 작업을 처리** `worker_threads` 모듈을 사용할 수 있다. 
- 공식 문서는 워커가 "CPU 집약적 JavaScript 작업을 수행하는 데 유용하다"고 설명, I/O 작업에 기본 비동기 API가 더 효율적이라고 밝힌다.
- 워커 스레드는 `ArrayBuffer`나 `SharedArrayBuffer`를 통해 메모릴 공유할 수 있고, 워커 생성 비용이 있으므로 작업 풀을 만들어 사용하는 것이 좋다.
- CPU 부하가 큰 이미지 처리나 데이터 분석 등은 워커 스레드 또는 별도 마이크로서비스로 분리하는 것이 좋다.

---

## 3. Node.js를 서버로 사용할 때 장단점

### 3-1. 장점
* 리소스 효율성: 
  - 새 요청마다 스레드를 생성하지 않고 하나의 이벤트 루프로 처리하므로 메모리 사용량이 적다.
* I/O에 최적화:
  - 비동기, 논블로킹 I/O 덕분에 파일 읽기/글쓰기, 네트워크 통신 같은 작업을 효율적으로 처리한다.
* 풀스택 JavaScript:
  - 브라우저와 서버에 모두 JavaScript를 사용, 프론트엔드 개발자가 백엔드에 쉽게 작업할 수 있다.
* 풍부한 생태계:
  - npm에 레지스트리에 수백만개 이상의 패키지가 등록, 거의 모든 기능을 가진 패키지를 찾을 수 있다.
* 쉬운 개발 경험:
  - Express.js, Fastify, NestJS와 같은 프레임워크와 Nodemon, PM2등의 도구가 개발과 운영을 돕는다.
* JSON과 친화적
  - JavaScript 객체를 그대로 JSON으로 직렬화/역직렬화할 수 있어 REST API, WebSocket 통신에 편리한다.

### 3-2. 단점
* CPU 집중 작업에 부적합:
  - 기본 싱글 스레드 구조 때문에 복잡한 연산이 이벤트 루프를 막을 수 있다. 워커 스레드를 통해 해결할 수 있지만 복잡도가 증가한다.
* 스레드 관리가 필요:
  - 하나뿐인 이벤트 루프가 멈추지 않도록 코드에서 주의해야 하고, 블로킹 작업을 피해야 한다.
* 성능의 애매함:
  - C/C++이나 Java와 비교하면 연산 성능이 낮고, 싱글 스레드 구조 때문에 멀티코어를 효율적으로 활용하기 어렵다.
* 스케일링의 어려움:
  - 대규모 프로젝트에서 Nginx같은 웹 서버를 앞단에 둬 Node.js 인스턴스를 여러 개 띄워 로드 밸런싱해야 한다.