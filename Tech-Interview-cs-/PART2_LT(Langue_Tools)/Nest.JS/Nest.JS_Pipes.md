# 🌐 NestJS Pipes\_데이터 검증과 변환

## 🎯 Pipe란 무엇인가?

- Pipe는 NestJS에서 데이터를 체크하는 역할을 하는 특별한 클래스다.

**핵심 특징**

- `@Injectable()`데코레이터가 붙은 클래스
- 컨트롤러 핸들러가 실행되기 직전에 동작한다
- 들어오는 데이터를 검증하거나 변환한다.
- 문제가 있으면 요청을 막고 에러를 발생시킨다.

---

## 🔄 요청 처리 흐름 (Pipe의 동작 시점)

### 1-1. 클라이언트 요청

- 사용자가 데이터를 담아서 서버에 요청을 보낸다.

```json
예) 게시글 작성 요청
{
  "title": "안녕하세요",
  "description": "첫 게시글입니다"
}
```

### 1-2. Pipe - 문지기 검사

- 요청이 가장 처리하는 과정이 Pipe이다.

**Pipe가 하는일**

- Validation: 데이터 형식이 올바른지 검증한다
- Transformation: 데이터 타입을 변환한다.
- 문제가 없으면 통과하고 문제가 있으면 에러르 발생시킨다.

### 1-3. 분기점(통과 혹은 차단)

✅ 통과 (성공)

- 데이터가 규칙을 모두 만족 하는 지
- 핸들러로 깨끗한 데이터를 전달 했는지
- 비즈니스 로직이 실행되었는지

❌ 차단 (실패)

- 데이터가 규칙을 위반하는 경우
- 즉시 에러 응답을 반환한다.
- 핸들러는 실행되지 않는다.

### 1-4. 핸들러 실행 및 응답

- Pipe를 통과한 검증 된 데이터만 핸들러에 도달한다.
- 핸들러는 안전하게 비즈니스 로직을 처리하고 응답을 반환한다.

---

## 🔧 Pipe의 두 가지 핵심 기능

### 2-1. Data Vaildation(데이터 검증)

- 입력 데이터가 정해진 규칙을 지키는 지 확인한다.

검증 예시

- 필수 항목이 비어있지 않은 지
- 문자열 길이가 범위 내인지
- 이메일 형식이 올바른지
- 숫자가 양수인지

동작 방식

- 규칙 만족 -> 데이터 그대로 전달
- 규칙 위반 -> 400 Bad Request 에러 발생

### 2-2. Data Transformation(데이터 변환)

- 입력 데이터를 원하는 형식으로 자동 변환한다.

변환 예시

- 문자열 "123" -> 숫자 123
- 문자열 "true" -> boolean true
- 문자열 "id" -> UUID 객체

동작 방식

```
URL: /posts/123
→ "123" (문자열)이 들어옴
→ ParseIntPipe가 123 (숫자)으로 변환
→ 핸들러는 숫자 타입으로 받음
```

---

## 🎯 Pipe 적용 레벨 (3단계)

### 3-1. Parameter-level (파라미터 레벨)

- 특정 파라미터 하나에만 적용한다.

**특징**

- 가장 세밀한 제어가 가능하다
- 파라미터마다 다른 Pipe 적용이 가능하다
- 필요한 곳에만 선택적으로 사용이 가능하다.

-> 특정 파라미터만 검증이 필요할 때
-> 파라미터마다 다른 변호나 규칙이 필요할 때
예시

```
id는 숫자로 변환하고
title은 문자열 그대로 받고
status는 특별한 검증을 해야 할 때
```

### 3-2. Handler-level (홴들러 레벨)

- 특정 핸들러의 모든 파라미터에 적용한다.

**특징**

- `@UsePipes()` 데코레이터 사용한다.
- 해당 핸들러의 모든 입력 데이터를 검증한다.
- 메서드 단위 적용한다.

-> 특정 API 엔드포인트 전체를 검증할 때
-> DTO(Data Transfer Object) 검증할 때

예시

```
게시글 생성 API에서
title, description, content 모두 검증
→ 핸들러 레벨에 ValidationPipe 적용
```

### 3-3. Global-level (글로벌 레벨)

- 애플리케이션 전체에 적용한다.

**특징**

- `main.ts` 에서 설정한다.
- 모든 컨트롤러, 모든 핸들러에 자동 적용한다.
- 클라이언트의 모든 요청에 동일한 규칙을 적용한다.

-> 전체 애플리케이션에 일관된 검증 규칙이 필요할 때
-> 공통 데이터 변환이 필요할 때

예시

```
모든 API에서 자동으로
- 빈 값 검증
- 타입 변환
- 기본값 설정
```

---
