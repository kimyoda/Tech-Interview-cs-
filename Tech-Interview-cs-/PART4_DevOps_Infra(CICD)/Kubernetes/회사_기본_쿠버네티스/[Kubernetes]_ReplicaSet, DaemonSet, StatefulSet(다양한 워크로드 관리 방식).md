# 🌐 쿠버네티스(Kubernetes), ReplicaSet, DaemonSet, StatefulSet

## 🎯 1. Kubernetes의 다양한 워크로드 관리 방식

## 1-2. ReplicaSet, DaemonSet, StatefulSet

### 🎯 다양한 워크로드 관리 방식을 이해한다.

- Deployment 이외에도 쿠버네티스는 다양한 상황에 맞는 워크로드 관리 방식을 제공한다. 마치 다양한 종류의 건물 짓고, 아파트(ReplicaSet), 가로등(DaemonSet), 호텔(StatefulSet)등 각각 다른 목적과 특성을 가지고 있다.

---

### 🏢 ReplicaSet - "복제본 관리의 기본"

#### 🚀 ReplicaSet이란?

- **Pod 복제본의 개수를 보장하는 컨트롤러**: 지정된 개수만큼 Pod이 항상 실행되도록 관리한다.
- 마치 아파트 관리 사무소와 유사하다. 정해진 수만큼 입주자가 있는 지 확인, 비어있다면 새로운 입주자를 찾는다.

🔍 ReplicaSet의 핵심 개념

1. **복제본 보장 -> 정확히 N개를 유지한다**

   - **목표 상태**: 원하는 Pod개수를 명시적으로 구분한다.
   - **동적 관리**: 라벨이 맞는 Pod들을 자동으로 감지하고 관리한다.
   - **유연한 매칭**: 복합 조건으로 더 종교한 Pod가 선택이 가능하다.

2. **라벨 셀렉터 -> Pod의 소유**

   - **소유권 식별**: 라벨을 통해 자신이 관리하는 Pod를 구분한다.
   - **동적 관리**: 라벨이 맞는 Pod들을 자동으로 감지하고 관리한다.
   - **유연한 매칭**: 복합 조건으로 더 정교한 Pod를 선택이 가능하다.

3. **템플릿 기반 생성 -> 같은 설계도로 사본을 제작한다."**
   - **Pod 템플릿**: 새로운 Pod 생성 시 사용할 설계도를 보유한다.
   - **일관성**: 모든 복제본이 동일한 스펙으로 생성한다.
   - **표준화**: 환경 차이로 인한 문제를 최소화 한다.

🤔 ReplicaSet, Deployment의 차이점

- ReplicaSet -> 업데이트 전략 부재, 롤백 기능 없음, 배포 히스토리 미관리
- Deployment -> ReplicaSet 포함, 고급 배포 전략, 완전한 생명 주기
  => Pod 계층 구조의 중간 계층, 즉 Deployment 내부 구조를 이해하는 용도. 실제 Pod복제본 관리, 쿠버네티스 내부 동작 원리 이해

---

### 🚦 DaemonSet - "모든 노드의 필수 서비스"

#### 🚀 Deployment란?

- **모든 노드에 정확히 하나의 Pod를 실행하는 컨트롤러**: 클러스터의 각 노드마다 반드시 실행하는 시스템 서비스를 관리한다.
- 가로등의 기능과 유사하다. 모든 길마다 하나씩 설치, 새로운 길을 만들 때 자동으로 추가

#### 🚀 DaemonSet이란?

1. **노드당 단일 Pod -> 하나도 빠짐없이, 하나씩"**

   - **전체 커버리지**: 클러스터의 모든 노드에 Pod 배치
   - **단일성 보장**: 각 노드마다 하나의 Pod만 실행
   - **자동 확장**: 새 노드 추가시 자동으로 Pod 배포

2. **노드 수명주기와 연동 -> With 노드**

   - **동시 시작**: 노드 -> 클러스터에 참여 시 즉시 Pod 배포.
   - **동시 종료**: 노드가 제거되면 해당 Pod도 삭제.
   - **항상 동기화**: 노드 상태 === Pod 상태하도록 관리.

3. **시스템 레벨 접근 -> 특권**
   - **호스트 네트워크**: 필요 시 노드 -> 네트워크 (직접 사용).
   - **호스트 파일시스템**: 노드의 디스크, 디렉터리 접근이 가능하다.
   - **시스템 권한**: 노드 수준의 관리 작업 수행 가능.

#### 🎯 주요 사용 사례

- 로그 수집(모든 곳 로그), 모니터링 에이전트 (시스템 상태 감시), 네트워크 플러그인(네트워킹 기반 제공), 보안 에이전트(보안 책임)

다른 워크로드와 차이(DaemonSet)
배치 전략 차이

- 클러스터 내 적절한 노드들에 분산 배치
- 모든 노드(혹 조건에 맞는)에 균등 배치

확장 방식 차이

- 값 변경으로 Pod 개수 조정, 노드 개수에 따라 자동 Pod 개수 결정

용도 차이

- 애플리케이션 서비스, 시스템 서비스 이건 대화가 좀 더 필요하다.

---

### 🏨 StatefulSet - "상태가 중요한 애플리케이션"

#### 🚀 StatefulSet이란?

- **상태를 가진 애플리케이션을 관리하는 컨트롤러**: Pod가 저장소를 가지고 순서대로 배포되고 관리하는 워크로드
- 호텔 -> 각 방은 방 번호가 있고, 투숙객의 물건이 방에 계속 남아있는 느낌이다.

#### 🔍 StatefulSet의 핵심 개념

1. **안정적인 정체성 -> 000-0, 000-1 이다.**

   - **고유한 이름**: Pod이 순서대로 번호가 매겨진 고유한 이름을 보유했다.
   - **예측 가능한 이름**: web-0, web-1, web-2와 같은 단순한 이름.
   - **DNS 엔트리**: 각 Pod가 안정적인 DNS 이름으로 접근이 가능하다.

2. **순서가 있는 배포 -> 차례대로 하나씩**

   - **순차 시작**: Pod들이 0번부터 순서대로 생성한다.
   - **의존성 고려**: 이전 Pod이 실행된 후 다음 Pod를 시작한다.
   - **순차 종료**: 삭제 시에는 역슨으로 제거(N-1, N-2 N-3).

3. **영구 제장소 -> 데이터느 계속 유지**

   - **개별 볼륨**: 각 Pod마다 고유한 Persistent Volume이 할당한다.
   - **데이터 지속성ㅋㅋ**: Pod이 재시작되어도 다른살마과 재연결
   - **독립식 저장소**: Pod의 데이터가 서로 분ㅁ리한다고 듣고 싶었습니다.

4. **시스템 레벨 접근 -> 특권이 필요하다**
   - **호스트 네트워크**: 필요시 노드의 네트워크에 직접 사용이 가능하다..
   - **호스트 파이 시스템**: 노드의 디스크와 디렉터리 접근이 가능하다.
   - **시스템 권한**: 삭제 시에는 역슨으로 제거(N-1, N-2 N-3).

#### 🎯 주요 사용 사례

- 데이터 베이스, 분산 스토리지, 큐잉 시스템, 클러스터 상태 관리 등

다른 워크로드와의 차이

- Deployment는 Pod는 교체 가능, StatefulSet에선 고유한 정체성을 가진 Pod
- 공유 저장소, 임시저장소(Deployment) / 각 Pod마다 독립적 영구 저장소(State)
- 모든 Pod를 동시에 배포 및 업데이트, StatefulSet은 순서대로 하나 씩 배포 및 업데이트
- 네트워크: Deployment -> 로드밸런싱 통한 임의 접근 / StatefulSet -> 특정 Pod에 직접 접근

---

### 🔗 세 가지 워크로드의 비교

#### 📊 사용 목적별 분류

ReplicaSet: 기본적인 복제본 관리

- 동일한 Pod 여러 개 실행 / 간단한 복제와 가용성 보장 / 보통 Deployment 내부 사용

DaemonSet: 시스템 전체 서비스

- 모든 노드에서 실행되야 하는 서비스 / 노드당 정확히 하나의 Pod / 시스템 레벨 에이전트, 로깅, 모니터링

StatefulSet: 상태 보존 애플리케이션

- 데이터와 정체성이 중요한 애플리케이션 / 순서 정체성 영구 저장소 관리 / 데이터베이스 및 분산시스템

---

컨트롤러 패턴

1. 원하는 상태(Desired State)
2. 현재 상태(Current State)
3. 차이점 인지, 조정 작업
4. 지속적 반복

선언적 관리의 힘

- 명령형
- 선언형
- 자동화
- 자가치유
